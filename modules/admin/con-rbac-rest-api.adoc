[id='con-rbac-rest-api_{context}']
= Role-based Access Control (RBAC) REST API

{product} provides RBAC REST API that you can use to manage the permissions and roles in the {product-short}. This API supports you to facilitate and automate the maintenance of {product-short} permission policies and roles.

Using the RBAC REST API, you can perform the following actions:

* Retrieve information about all permission policies or specific permission policies, or roles
* Create, update, or delete a permission policy or a role
* Retrieve permission policy information about static plugins

The RBAC REST API requires the following components:

*Authorization*

The RBAC REST API requires Bearer token authorization for the permitted user role. For development purposes, you can access a web console in a browser. When you refresh a token request in the list of network requests, you find the token in the response JSON.

`Authorization: Bearer $token`

For example, on the *Homepage* of the {product-short}, you can navigate to the *Network* tab and search for the `query?term=` network call. Alternatively, you can go to the *Catalog* page and select any network call with `entity-facets` to acquire the Bearer token. 

*HTTP methods*

The RBAC REST API supports the following HTTP methods for API requests:

* `GET`: Retrieves specified information from a specified resource endpoint
* `POST`: Creates or updates a resource
* `PUT`: Updates a resource
* `DELETE`: Deletes a resource

*Base URL*

The base URL for RBAC REST API requests is `pass:c[http://SERVER:PORT/api/permission/policies]`, such as `pass:c[http://localhost:7007/api/permission/policies]`.

*Endpoints*

RBAC REST API endpoints, such as `/api/permission/policies/[kind]/[namespace]/[name]` for specified kind, namespace, and username, are the URI that you append to the base URL to access the corresponding resource.

Example request URL for `/api/permission/policies/[kind]/[namespace]/[name]` endpoint is:

`pass:c[http://localhost:7007/api/permission/policies/user/default/johndoe]`

[NOTE]
====
If at least one permission is assigned to `user:default/johndoe`, then the example request URL mentioned previously returns a result if sent in a `GET` response with a valid authorization token. However, if permission is only assigned to roles, then the example request URL does not return an output.
====

*Request data*

HTTP `POST` requests in the RBAC REST API may require a JSON request body with data to accompany the request.

Example `POST` request URL and JSON request body data for
`pass:c[http://localhost:7007/api/permission/policies]`:

[source,json]
----
{
    "entityReference": "role:default/test",
    "permission": "catalog-entity",
    "policy": "delete",
    "effect": "allow"
}
----

*HTTP status codes*

The RBAC REST API supports the following HTTP status codes to return as responses:

* `200` OK: The request was successful.
* `201` Created: The request resulted in a new resource being successfully created.
* `204` No Content: The request was successful, but there is no additional content to send in the response payload.
* `400` Bad Request: input error with the request
* `401` Unauthorized: lacks valid authentication for the requested resource
* `403` Forbidden: refusal to authorize request
* `404` Not Found: could not find requested resource
* `409` Conflict: request conflict with the current state and the target resource

*Source*

Each permission policy and role that is created through the RBAC plugin will have a source associated with it. This source information is used to keep consistency of the data throughout the plugin. The plugin utilizes a fairly strict approach of only allowing permission policies and roles to be manipulated based on their source information.

There are four different source locations that a permission policy or role could be attached to. This includes the CSV file, Configuration file, REST API, and legacy. CSV file and REST API are fairly straightforward and involve modifying the role and permission policies based on the source information of the originally created role.

Configuration file involves the default `role:default/rbac_admin` role that comes with the RBAC plugin. This role is limited to only having access creating, reading, updating, and deleting permission policies/roles and having access to read catalog entities. If this is insufficient for your needs for the admins, consider crafting your own admin role with the permission policies that you require.

Finally, the legacy source is a source that may appear if your permission policies and roles were defined prior to RBAC Backend plugin version `2.1.3` and is the least strict of the different source options. This is because it is recommended to attempt to update these permissions and roles to a source of REST API or CSV file. This can be done by redefining these permission policies and roles using one of the available options. You can query your roles and permission policies using the `GET` requests outlined below to find the source information of your policies.
